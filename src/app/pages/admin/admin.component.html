<section class="admin-page">
  <div class="admin-container">
    <h1 class="admin-title">Dashboard Admin</h1>

    <div class="tabs" role="tablist">
      <button
        class="tab"
        role="tab"
        [attr.aria-selected]="activeTab() === 'projects'"
        [class.active]="activeTab() === 'projects'"
        (click)="switchTab('projects')">
        Progetti
      </button>
      <button
        class="tab"
        role="tab"
        [attr.aria-selected]="activeTab() === 'messages'"
        [class.active]="activeTab() === 'messages'"
        (click)="switchTab('messages')">
        Messaggi
      </button>
    </div>

    @if (activeTab() === 'projects') {
      <div class="tab-content" role="tabpanel">
        <div class="tab-header">
          <h2>Progetti ({{ projects().length }})</h2>
          <button class="btn-add" (click)="openAddProject()">+ Aggiungi Progetto</button>
        </div>

        @if (projects().length === 0) {
          <p class="empty">Nessun progetto presente.</p>
        } @else {
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Titolo</th>
                  <th>Tech Stack</th>
                  <th>Azioni</th>
                </tr>
              </thead>
              <tbody>
                @for (project of projects(); track project.id) {
                  <tr>
                    <td>{{ project.title }}</td>
                    <td>
                      <div class="tech-tags">
                        @for (tech of project.techStack; track $index) {
                          <span class="tech-tag">{{ tech }}</span>
                        }
                      </div>
                    </td>
                    <td>
                      <div class="actions">
                        <button class="btn-edit" (click)="openEditProject(project)">Modifica</button>
                        <button class="btn-delete" (click)="deleteProject(project)">Elimina</button>
                      </div>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        }
      </div>
    }

    @if (activeTab() === 'messages') {
      <div class="tab-content" role="tabpanel">
        <h2>Messaggi ({{ messages().length }})</h2>

        @if (messages().length === 0) {
          <p class="empty">Nessun messaggio ricevuto.</p>
        } @else {
          <div class="messages-list">
            @for (msg of messages(); track msg.id) {
              <div class="message-card">
                <div class="message-header">
                  <div>
                    <strong>{{ msg.name }}</strong>
                    <span class="message-email">{{ msg.email }}</span>
                  </div>
                  <div class="message-meta">
                    @if (msg.createdAt) {
                      <span class="message-date">{{ msg.createdAt }}</span>
                    }
                    <button class="btn-delete-sm" (click)="deleteMessage(msg)">Elimina</button>
                  </div>
                </div>
                <p class="message-body">{{ msg.message }}</p>
              </div>
            }
          </div>
        }
      </div>
    }
  </div>
</section>

@if (showProjectForm()) {
  <app-project-form
    [project]="editingProject()"
    (saved)="onProjectSaved()"
    (cancelled)="closeProjectForm()" />
}
