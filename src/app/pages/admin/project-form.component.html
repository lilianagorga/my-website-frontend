<div class="modal-overlay" (click)="onOverlayClick($event)">
  <div class="modal">
    <h2>{{ isEditing ? 'Modifica Progetto' : 'Aggiungi Progetto' }}</h2>

    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="title">Titolo</label>
        <input id="title" type="text" formControlName="title" placeholder="Titolo del progetto" />
        @if (form.get('title')?.touched && form.get('title')?.invalid) {
          @if (form.get('title')?.hasError('required')) { <span class="error">Il titolo è obbligatorio.</span> }
          @if (form.get('title')?.hasError('maxlength')) { <span class="error">Massimo 100 caratteri.</span> }
        }
      </div>

      <div class="form-group">
        <label for="description">Descrizione</label>
        <textarea id="description" formControlName="description" rows="4" placeholder="Descrizione del progetto"></textarea>
        @if (form.get('description')?.touched && form.get('description')?.invalid) {
          @if (form.get('description')?.hasError('required')) { <span class="error">La descrizione è obbligatoria.</span> }
          @if (form.get('description')?.hasError('maxlength')) { <span class="error">Massimo 500 caratteri.</span> }
        }
      </div>

      <div class="form-group">
        <label for="techStack">Tech Stack</label>
        <input id="techStack" type="text" formControlName="techStack" placeholder="Angular, Spring Boot, PostgreSQL" />
        <span class="hint">Valori separati da virgola</span>
      </div>

      <div class="form-group">
        <label for="imageUrl">URL Immagine</label>
        <input id="imageUrl" type="text" formControlName="imageUrl" placeholder="https://..." />
        @if (form.get('imageUrl')?.touched && form.get('imageUrl')?.invalid) {
          <span class="error">Inserisci un URL valido (http/https).</span>
        }
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="githubUrl">URL GitHub</label>
          <input id="githubUrl" type="text" formControlName="githubUrl" placeholder="https://github.com/..." />
          @if (form.get('githubUrl')?.touched && form.get('githubUrl')?.invalid) {
            <span class="error">Inserisci un URL GitHub valido.</span>
          }
        </div>
        <div class="form-group">
          <label for="demoUrl">URL Demo</label>
          <input id="demoUrl" type="text" formControlName="demoUrl" placeholder="https://..." />
          @if (form.get('demoUrl')?.touched && form.get('demoUrl')?.invalid) {
            <span class="error">Inserisci un URL demo valido.</span>
          }
        </div>
      </div>

      @if (errorMessage) {
        <div class="alert-error">{{ errorMessage }}</div>
      }

      <div class="form-actions">
        <button type="button" class="btn-cancel" (click)="onCancel()">Annulla</button>
        <button type="submit" class="btn-save" [disabled]="submitting || form.invalid">
          {{ submitting ? 'Salvataggio...' : (isEditing ? 'Aggiorna' : 'Crea') }}
        </button>
      </div>
    </form>
  </div>
</div>
